
<!DOCTYPE html>
<html lang="nl">
<head>
  <!--
    🧭 Overzicht
    ============
    Dit bestand is een volledig gedocumenteerde versie van je Vocaluxe-songs site.
    - Leest songs in uit 'songs.csv' (staat naast dit HTML-bestand)
    - Desktop: alfabetknoppen (A–Z), zoekveld, scrollbare lijst
    - Mobiel: géén alfabetknoppen, wel A−/A+ boven het zoekveld om de lettergrootte te regelen
    - Bovenaan: vaste balk met "Update: dd/mm/jjjj" en het (gefilterde) aantal liedjes
    - CSV wordt altijd vers opgehaald (cache-busting) en ook opnieuw ingelezen wanneer je tabblad terug in focus komt
    - Robuuste CSV-parsing: hoofdletterongevoelig en meerdere mogelijke kolomnamen voor uitvoerder/titel

    🔧 Hoe te gebruiken
    -------------------
    - Zet dit bestand als 'index.html' op GitHub Pages (in je repo 'vocsongs.github.io/Vocaluxe/')
    - Plaats 'songs.csv' en 'SiteBG.png' in dezelfde map
    - Werk je CSV bij → gewoon uploaden/committen; de site leest automatisch de nieuwe versie in
  -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Vocaluxe Songs</title>

  <!--
    🚫 Cache-instructies (optioneel)
    Deze meta-tags verzoeken de browser om de HTML niet te cachen.
    Wil je absoluut altijd de nieuwste HTML? Laat ze staan.
    Vind je het te agressief? Dan kun je ze verwijderen.
  -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    /* =====================
       🌈 BASIS LAYOUT / STIJL
       ===================== */

    /* Variabele voor de lettergrootte van de lijst (via A−/A+ op mobiel te wijzigen) */
    :root { --list-font: 1.15em; }

    html, body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      color: white;
      height: 100%;
      /* Achtergrondafbeelding (door jou aangeleverd) */
      background: url('SiteBG.png') no-repeat center top;
      /* Standaard: scherm vullend, kan randen afsnijden (desktop) */
      background-size: cover;
      /* Vastzetten zodat hij niet mee scrollt met de lijst */
      background-attachment: fixed;
      /* We gebruiken een interne scrollcontainer; html/body blijven "verstopt" */
      overflow: hidden;
    }

    /* 📱 MOBIEL achtergrond-gedrag:
       - Toon de volledige hoogte van de afbeelding (niet afsnijden)
       - Zet het anker bovenaan in het midden (center top)
       - Daardoor kun je links/rechts zwarte randen krijgen: dat is oké */
    @media (max-width: 820px) {
      html, body {
        background-size: auto 100%;
        background-position: center top;
      }
    }

    /* =============================
       📌 BOVENBALK MET META-INFORMATIE
       ============================= */
    .top-meta {
      position: fixed;    /* Altijd zichtbaar */
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.6);   /* Donkere transparante balk voor leesbaarheid */
      z-index: 2000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.35);
    }
    .top-meta .meta-wrap {
      /* Gecentreerde binnencontainer zodat tekst niet tegen de randen komt */
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 6px 16px;
      font-size: 0.95em;
    }

    /* =======================
       🧭 BEDIENING (knoppen/zoek)
       ======================= */
    .top-bar {
      position: sticky;   /* Blijft plakken bij scrollen, onder het titelgebied van je afbeelding */
      top: 170px;         /* 🔽 Verticale positie: hoger getrokken op jouw vraag (+30 px t.o.v. eerder) */
      width: 100%;
      z-index: 1000;
      text-align: center;
      padding-bottom: 10px;
      background: rgba(0, 0, 0, 0.0); /* transparant zodat de achtergrond zichtbaar blijft */
    }

    .filter-row {
      /* Rij die het zoekveld en (op mobiel) A−/A+ bevat */
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
      flex-wrap: wrap;
      position: relative; /* Nodig om A−/A+ absoluut t.o.v. deze rij te positioneren */
    }

    /* Alfabetknoppen (desktop) */
    .filter-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 5px;
      margin-bottom: 10px;
    }
    .filter-buttons button {
      padding: 5px 8px;
      border: none;
      border-radius: 2px;
      background-color: rgba(0,0,0,0.6);
      color: white;
      cursor: pointer;
      font-size: 1em;
    }
    .filter-buttons button:hover { background-color: rgba(255,255,255,0.2); }

    /* Zoekveld (desktop én mobiel) */
    #search {
      padding: 6px;
      font-size: 1em;
      width: min(90%, 420px);
      border-radius: 5px;
      border: none;
      margin: 6px 0 0;
      background-color: rgba(255, 255, 255, 0.2); /* zwart met 40% transparantie */
      color: white;
    }

    /* A−/A+ enkel op mobiel, links boven het zoekveld, 50px vanaf de linkerrand */
    .font-controls-mobile {
      display: none;      /* Desktop: onzichtbaar */
      position: absolute; /* Positioneren t.o.v. .filter-row */
      left: 50px;
      top: -40px;         /* Boven het zoekveld */
      gap: 6px;
    }
    .font-btn {
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      background-color: rgba(0,0,0,0.6);
      color: white;
      cursor: pointer;
      font-size: 1em;
      line-height: 1;
    }
    .font-btn:active { transform: translateY(1px); }

    /* =========================
       📜 SCROLLBARE LIJSTCONTAINER
       ========================= */
    .content {
      position: absolute;
      /* 🔽 30 px hoger gezet op jouw vraag */
      top: 220px;
      bottom: 0;
      left: 0;
      right: 0;
      overflow-y: auto;  /* Alleen deze container scrollt */
      padding: 10px 0 20px;
      text-align: center;
    }

    /* De lijst met nummers (donkere doorschijnende achtergrond voor leesbaarheid) */
    #song-list {
      font-family: Arial, sans-serif;
      background: rgba(0, 0, 0, 0.6);
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      margin: 0 auto;
      max-width: 900px;
      border-radius: 10px;
      padding: 10px 0;
    }

    /* Eén regel in de lijst (centrale uitlijning rond een denkbeeldige scheiding) */
    .line {
      display: flex;
      justify-content: center;   /* Zorgt dat de kolommen centreren */
      align-items: center;
      font-size: var(--list-font); /* Variabele die je met A−/A+ instelt */
      padding: 4px 0;
    }
    .left-col {
      /* Uitvoerder rechts uitgelijnd */
      width: 40%;
      text-align: right;
      padding-right: 10px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .right-col {
      /* Titel links uitgelijnd */
      width: 40%;
      text-align: left;
      padding-left: 10px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* =====================
       📱 MOBIELE AANPASSINGEN
       ===================== */
    @media (max-width: 820px) {
      /* Verberg alfabetknoppen op mobiel */
      .filter-buttons { display: none; }

      /* Iets compactere teksten bovenaan */
      .top-meta .meta-wrap { padding: 6px 10px; font-size: 0.9em; }

      /* Zoekveld iets breder op mobiel */
      #search { width: 92%; }

      /* Iets kleinere standaard lettergrootte op mobiel */
      :root { --list-font: 0.95em; }

      /* Toon A−/A+ op mobiel */
      .font-controls-mobile { display: flex; }
    }
  </style>

  <!-- CSV parser library (PapaParse) voor robuust en snel CSV inlezen -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <!--
    🔷 META-BALK BOVENAAN
    Links: Update-datum (wanneer de CSV geladen werd)
    Rechts: totaal aantal liedjes (en bij filtering: "x getoond")
  -->
  <div class="top-meta">
    <div class="meta-wrap">
      <div id="last-update">Update: —</div>
      <div id="song-count">— liedjes</div>
    </div>
  </div>

  <!--
    🔹 Bediening: alfabetknoppen (desktop), zoekveld (desktop+mobiel),
       en A−/A+ (alleen mobiel, absoluut gepositioneerd boven het zoekveld).
  -->
  <div class="top-bar">
    <div class="filter-buttons" id="buttons"></div>

    <div class="filter-row">
      <div class="font-controls-mobile" aria-label="Lettergrootte">
        <button id="font-dec" class="font-btn" title="Kleiner">A−</button>
        <button id="font-inc" class="font-btn" title="Groter">A+</button>
      </div>

      <input type="text" id="search" placeholder="Zoek op uitvoerder of titel..." />
    </div>
  </div>

  <!--
    📃 Scrollbare lijst met songs.
    Wordt dynamisch gevuld via JavaScript (displaySongs()).
  -->
  <div class="content">
    <div id="song-list">Laden...</div>
  </div>

  <script>
    /* ==============================
       🧠 STATE / VARIABELEN
       ============================== */
    let allSongs = [];      // Volledige lijst (na inlezen en opschonen)
    let totalCount = 0;     // Totaal aantal songs (na opschonen)
    let lastLoaded = null;  // Laatste keer dat CSV werd ingelezen
    let fontSizeEm = 1.15;  // Startwaarde voor —list-font (desktop)

    /* ==================================
       🔡 HULPFUNCTIES (formatter & parsing)
       ================================== */

    // Nederlandse datumnotatie dd/mm/jjjj
    function formatDate(d){
      try {
        return new Intl.DateTimeFormat('nl-BE',{day:'2-digit',month:'2-digit',year:'numeric'}).format(d);
      } catch {
        return d.toLocaleDateString('nl-BE');
      }
    }

    // Normaliseer CSV-keys: trim + lowercase, zodat headers hoofdletterongevoelig worden
    function normKeyMap(obj) {
      const m = {};
      for (const k in obj) {
        if (!k) continue;
        m[k.trim().toLowerCase()] = obj[k];
      }
      return m;
    }

    // Kies de eerste beschikbare waarde uit mogelijke kolomnamen
    function pick(obj, candidates) {
      for (const c of candidates) {
        if (obj[c] != null && String(obj[c]).trim() !== "") return String(obj[c]).trim();
      }
      return "";
    }

    // Pas visueel de lijst-lettergrootte aan (A−/A+)
    function applyFontSize(){
      document.documentElement.style.setProperty('--list-font', fontSizeEm + 'em');
    }

    /* ==============================
       ⬇️ CSV INLADEN (met cache-busting)
       ============================== */
    function loadSongs(cacheBust = true) {
      // Cache-busting zorgt dat de nieuwste CSV wordt opgehaald
      const url = cacheBust ? `songs.csv?ts=${Date.now()}` : 'songs.csv';

      Papa.parse(url, {
        download: true,
        header: true,                 // Lees eerste rij als kolomnamen
        skipEmptyLines: 'greedy',     // Sla lege rijen agressief over
        complete: function(results) {
          lastLoaded = new Date();

          // Map elke rij naar { uitvoerder, titel } met flexibele kolomnamen
          allSongs = results.data
            .map(row => {
              const m = normKeyMap(row);
              const uitvoerder = pick(m, ['uitvoerder','uitvoeder','artist','artiest','performer','singer']);
              const titel      = pick(m, ['titel','title','song','nummer','track']);
              return { uitvoerder, titel };
            })
            .filter(s => s.uitvoerder && s.titel); // Sla rijen zonder beide velden over

          totalCount = allSongs.length;
          displaySongs(allSongs);
        },
        error: function(err) {
          document.getElementById('song-list').textContent =
            'Fout bij laden van songs.csv: ' + err.message;
          console.error('CSV Load Error:', err);
        }
      });
    }

    /* ==============================
       🖼️ LIJST TONEN + META UPDATEN
       ============================== */
    function updateMetaInfo(displayedCount) {
      const total = totalCount.toLocaleString('nl-BE');
      const shown = displayedCount.toLocaleString('nl-BE');
      const dateStr = lastLoaded ? formatDate(lastLoaded) : '—';

      // Links: Update-datum (dd/mm/jjjj)
      document.getElementById('last-update').textContent = `Update: ${dateStr}`;

      // Rechts: totaal + (x getoond) bij filtering/zoeken
      document.getElementById('song-count').textContent =
        (displayedCount !== totalCount) ? `${total} liedjes — ${shown} getoond` : `${total} liedjes`;
    }

    function displaySongs(songs) {
      const list = document.getElementById('song-list');
      list.innerHTML = '';

      // Sorteer alfabetisch op uitvoerder
      const sorted = songs.slice().sort((a,b) => a.uitvoerder.localeCompare(b.uitvoerder));

      // Voeg elke regel toe met de gewenste uitlijning (rechts/links)
      sorted.forEach(song => {
        const line = document.createElement('div');
        line.className = 'line';
        line.innerHTML =
          "<div class='left-col'>" + song.uitvoerder + "</div>" +
          "<div class='right-col'>" + song.titel + "</div>";
        list.appendChild(line);
      });

      // Werk bovenbalk bij (tellingen)
      updateMetaInfo(sorted.length);

      // Scroll de lijst telkens terug naar boven na ieder rendermoment
      const scroller = document.querySelector('.content');
      if (scroller) scroller.scrollTo({ top: 0, behavior: 'auto' });
    }

    /* ==============================
       🔤 ALFABETFILTER (desktop)
       ============================== */
    function filterByLetter(letter) {
      // Leeg het zoekveld bij letterselectie
      const search = document.getElementById('search');
      if (search) search.value = '';

      if (letter === 'Alles')        return displaySongs(allSongs);
      if (letter === '#')            return displaySongs(allSongs.filter(s => !/^[a-zA-Z]/.test(s.uitvoerder)));
      /* Anders filter: uitvoerder begint met gekozen letter */
      displaySongs(allSongs.filter(s => s.uitvoerder.toUpperCase().startsWith(letter)));
    }

    // Genereer de knoppen 'Alles', '#', 'A'..'Z' (alleen zichtbaar op desktop)
    function setupButtons() {
      const letters = [...'ABCDEFGHIJKLMNOPQRSTUVWXYZ'];
      const container = document.getElementById('buttons');
      ['Alles', '#', ...letters].forEach(letter => {
        const btn = document.createElement('button');
        btn.textContent = letter;
        btn.onclick = () => filterByLetter(letter);
        container.appendChild(btn);
      });
    }

    /* ==============================
       🔎 ZOEKEN (uitvoerder of titel)
       ============================== */
    document.getElementById('search').addEventListener('input', (e) => {
      const t = e.target.value.toLowerCase();
      if (!t) return displaySongs(allSongs);

      const filtered = allSongs.filter(s =>
        s.uitvoerder.toLowerCase().includes(t) ||
        s.titel.toLowerCase().includes(t)
      );
      displaySongs(filtered);
    });

    /* ==============================
       🔡 A−/A+ (alleen mobiel zichtbaar)
       ============================== */
    document.addEventListener('click', (e) => {
      if (e.target.id === 'font-dec') {
        // Verklein met stapjes van 0.05, min. 0.85em
        fontSizeEm = Math.max(0.85, +(fontSizeEm - 0.05).toFixed(2));
        applyFontSize();
      }
      if (e.target.id === 'font-inc') {
        // Vergroot met stapjes van 0.05, max. 1.40em
        fontSizeEm = Math.min(1.40, +(fontSizeEm + 0.05).toFixed(2));
        applyFontSize();
      }
    });

    /* ==============================
       🚀 INIT
       ============================== */
    setupButtons();    // Maak de alfabetknoppen (desktop)
    applyFontSize();   // Zet beginwaarde voor --list-font
    loadSongs(true);   // Lees CSV in met cache-busting

    // Herlaad automatisch wanneer je naar het tabblad terugkeert (CSV wordt opnieuw gelezen)
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) loadSongs(true);
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vocaluxe Songs</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    /* ===============================
       Globale variabelen (makkelijk aanpassen)
       =============================== */
    :root {
      /* Basis lettergrootte van de LIJST (A-/A+ beïnvloedt deze) */
      --list-font: 0.95em;

      /* ========== POSITIES (kun je per device apart instellen) ========== */
      --letters-top: 120px;
      --search-top: 160px;
      --font-top: 65px;
      --content-top: 220px;

      /* ========== SONG-LIJST breedte (per device) ========== */
      --phone-list-width: 95%;
      --desk-list-width: 1200px;

      /* ========== KNOPGROEP AFSTAND (gap) en KNOPPADDING (per device) ========== */
      /* Mobiel */
      --phone-btn-gap: 3px;
      --phone-btn-pad-v: 3px;
      --phone-btn-pad-h: 8px;
      --phone-btn-font-mult: 0.8;

      /* Desktop */
      --desk-btn-gap: 4px;
      --desk-btn-pad-v: 5px;
      --desk-btn-pad-h: 5px;
      --desk-btn-font-mult: 1;
    }

    /* Altijd zwarte basis achter de achtergrondafbeelding */
    html { background:#000 !important; }
    body {
      margin:0; padding:0; font-family:Arial, sans-serif; color:#fff;
      min-height:100vh;
      background-repeat:no-repeat;
      background-position:center top;
      background-size:cover;
      background-attachment:fixed;
      overflow:hidden;
    }

    /* ========== Mobiel: variabelen mappen ========== */
    @media (max-width: 820px) {
      body { background-image:url('BGPHONE.png'); }
      :root {
        --letters-top: var(--phone-letters-top, 10px);
        --search-top: var(--phone-search-top, 50px);
        --font-top: var(--phone-font-top, 30px);
        --content-top: var(--phone-content-top, 100px);
        --list-font: var(--phone-list-font, var(--list-font));
      }

      #song-list { max-width: var(--phone-list-width); }

      .filter-buttons { gap: var(--phone-btn-gap); }
      .filter-buttons button {
        font-size: calc(var(--list-font) * var(--phone-btn-font-mult));
        padding: var(--phone-btn-pad-v) var(--phone-btn-pad-h);
      }
    }

    /* ========== Desktop: variabelen mappen ========== */
    @media (min-width: 821px) {
      body { background-image:url('BGDESK.png'); }
      :root {
        --letters-top: var(--desk-letters-top, 95px);
        --search-top: var(--desk-search-top, 130px);
        --font-top: var(--desk-font-top, 30px);
        --content-top: var(--desk-content-top, 165px);
        --list-font: var(--desk-list-font, var(--list-font));
      }

      #song-list { max-width: var(--desk-list-width); }

      .filter-buttons { gap: var(--desk-btn-gap); }
      .filter-buttons button {
        font-size: calc(var(--list-font) * var(--desk-btn-font-mult));
        padding: var(--desk-btn-pad-v) var(--desk-btn-pad-h);
      }
    }

    /* A-/A+ vaste positie (desktop basis) */
    .font-controls {
      position:fixed;
      top:var(--font-top);
      right:clamp(12px, 4vw, 32px);
      display:flex; gap:8px;
      z-index:1200;
    }
    .font-btn {
      padding:6px 10px; border:none; border-radius:6px;
      background:rgba(0,0,0,.4); color:#fff; cursor:pointer; font-size:1em; line-height:1;
    }
    .font-btn:hover { background:rgba(255,255,255,.4); }

    /* Letterknoppen – vaste positie, gecentreerd */
    #letters-bar {
      position:fixed; top:var(--letters-top); left:0; right:0;
      z-index:1100; text-align:center; padding-bottom:4px;
      background:transparent;
    }
    .filter-buttons {
      display:flex; flex-wrap:wrap; justify-content:center; margin:0 auto;
      max-width:1200px;
    }
    .filter-buttons button {
      border:none; border-radius:6px;
      background:rgba(0,0,0,.4); color:#fff; cursor:pointer; line-height:1;
    }
    .filter-buttons button:hover { background:rgba(255,255,255,.4); }

    /* Zoekveld – vaste positie, gecentreerd */
    #search {
      position:fixed; top:var(--search-top); left:50%; transform:translateX(-50%);
      padding:8px; font-size:1em; width:min(90%, 520px);
      border-radius:8px; border:none; margin:0;
      background:rgba(255,255,255,.4); color:#fff;
      z-index:1150;
    }

    /* Scrollbare content */
    .content {
      position: fixed;
      top: var(--content-top);
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      text-align: center;
      padding: 10px 0 24px;
    }

    /* Liedjesvak */
    #song-list {
      background: rgba(0,0,0,.4);
      margin: 0 auto;
      border-radius: 10px;
      padding: 10px 0;
      position: relative;
      z-index: 1;
    }

    /* Rijen in de lijst */
    .line {
      display:flex; justify-content:center; align-items:center;
      font-size:var(--list-font);
      padding:4px 0;
    }
    .left-col, .right-col {
      width:40%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
    .left-col { text-align:right; padding-right:10px; }
    .right-col { text-align:left; padding-left:10px; }

    /* ========== Device-specifieke mapping van startgrootte naar --list-font ========== */
    @media (max-width: 820px) {
      :root { --list-font: var(--phone-list-font, 0.80em); }
    }
    @media (min-width: 821px) {
      :root { --list-font: var(--desk-list-font, 1.20em); }
    }

    /* ========== Mobiel: positie van de - en + knoppen links en rechtsboven ========== */
    @media (max-width: 820px) {
      .font-controls {
        position: fixed;
        top: 10px;
        left: 0;
        right: 0;
        display: flex;
        justify-content: space-between;
        padding: 0 14px;
        z-index: 2000;
      }

      .font-btn {
        font-size: 1.4em;
        padding: 4px 10px;
        border-radius: 8px;
      }

      /* ✅ Belangrijk: brede balk mag taalbuttons niet blokkeren */
      .font-controls { pointer-events: none; }
      .font-controls .font-btn { pointer-events: auto; }
    }

    /* =========================================================
       ✅ TAALFILTER VERPLAATST NAAR LINKSBOVEN (zelfde hoogte als A-/A+)
       ========================================================= */
    #language-bar {
      position: fixed;
      top: var(--font-top);
      left: clamp(12px, 4vw, 32px);
      z-index: 2100;
      text-align: left;
      background: transparent;
    }
    #language-bar .filter-buttons {
      justify-content: flex-start;
      max-width: none;
      margin: 0;
    }

    /* Mobiel: exact op dezelfde plek als de topbar (10px, 14px) */
    @media (max-width: 820px) {
      #language-bar {
        top: 10px;
        left: 14px;
      }
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <!-- A-/A+ -->
  <div class="font-controls" aria-label="Lettergrootte">
    <button id="font-dec" class="font-btn" title="Kleiner">−</button>
    <button id="font-inc" class="font-btn" title="Groter">+</button>
  </div>

  <!-- Letterknoppen -->
  <div id="letters-bar">
    <div class="filter-buttons" id="buttons"></div>
  </div>

  <!-- Zoekveld -->
  <input type="text" id="search" placeholder="Zoek op uitvoerder of titel..." />

  <!-- Taalfilter (NU LINKSBOVEN) -->
  <div id="language-bar">
    <div class="filter-buttons" id="lang-buttons"></div>
  </div>

  <!-- Scrollbare lijst -->
  <div class="content">
    <div id="song-list">Laden...</div>
  </div>

  <script>
    // ===============================
    // Logica & helperfuncties
    // ===============================

    // Gehele dataset
    let allSongs = [];
    let totalCount = 0;

    // Filter state
    let currentLetter = 'Alles';
    let currentLang   = 'Alle';
    let currentSearch = '';

    function normalizeLang(val){
      const t = (val || '').toString().trim().toUpperCase();

      if (t.includes('NEDER') || t.startsWith('NL')) return 'NL';
      if (t.includes('FRANS') || t.includes('FRANÇAIS') || t.includes('FRANCAIS') || t.startsWith('FR')) return 'FR';
      if (t.includes('DUITS') || t.includes('DEUTSCH') || t.startsWith('DU') || t.startsWith('DE')) return 'DU';
      if (t.includes('ANDER')) return 'A';
      if (t === '' || t === '-' || t === ' ') return '';
      return '';
    }

    function pick(o, candidates){
      for(const c of candidates){
        if(o[c]!=null && String(o[c]).trim()!=='') {
          return String(o[c]).trim();
        }
      }
      return '';
    }

    function loadSongs(cacheBust=true){
      const url = cacheBust ? `songs.csv?v=${Date.now()}` : 'songs.csv';
      Papa.parse(url, {
        download: true,
        header: true,
        skipEmptyLines: 'greedy',
        complete: result => {
          allSongs = result.data.map(row => {
            const m = {};
            for (const k in row){
              if (!k) continue;
              m[k.trim().toLowerCase()] = row[k];
            }

            const uitvoerder = pick(m, ['uitvoerder','uitvoeder','artist','artiest','performer','singer']);
            const titel      = pick(m, ['titel','title','song','nummer','track']);
            const taalRaw    = pick(m, ['taal','language','lang','l']);
            const taalCode   = normalizeLang(taalRaw);

            return { uitvoerder, titel, taalOrig: taalRaw, taalCode };
          }).filter(s => s.uitvoerder && s.titel);

          totalCount = allSongs.length;
          renderFiltered();
        },
        error: err => {
          document.getElementById('song-list').textContent =
            'Fout bij laden van songs.csv: ' + err.message;
        }
      });
    }

    function renderFiltered() {
      let list = allSongs.slice();

      const q = (currentSearch || '').toLowerCase();
      if (q) {
        list = list.filter(s =>
          (s.uitvoerder || '').toLowerCase().includes(q) ||
          (s.titel || '').toLowerCase().includes(q)
        );
      }

      if (currentLetter !== 'Alles') {
        if (currentLetter === '#') {
          list = list.filter(s => !/^[A-Z]/i.test((s.uitvoerder || '')));
        } else {
          const L = (currentLetter || '').toUpperCase();
          list = list.filter(s => (s.uitvoerder || '').toUpperCase().startsWith(L));
        }
      }

      if (currentLang !== 'Alle') {
        if (currentLang === 'A') {
          list = list.filter(s => s.taalCode === 'A');
        } else {
          list = list.filter(s => s.taalCode === currentLang);
        }
      }

      displaySongs(list);
    }

    function displaySongs(list){
      const container = document.getElementById('song-list');
      container.innerHTML = '';

      const sorted = list.slice().sort((a,b)=>{
        const au = a.uitvoerder.localeCompare(b.uitvoerder, 'nl', {sensitivity:'base'});
        if (au !== 0) return au;
        return a.titel.localeCompare(b.titel, 'nl', {sensitivity:'base'});
      });

      if (sorted.length === 0){
        container.innerHTML = '<div class="line"><div class="left-col"></div><div class="right-col"><em>Geen resultaten</em></div></div>';
      } else {
        sorted.forEach(x => {
          const div = document.createElement('div');
          div.className = 'line';
          div.innerHTML =
            '<div class="left-col">' + (x.uitvoerder || '') + '</div>' +
            '<div class="right-col">' + (x.titel || '') + '</div>';
          container.appendChild(div);
        });
      }

      const scroller = document.querySelector('.content');
      if(scroller) scroller.scrollTo({ top: 0, behavior: 'auto' });
    }

    function filterByLetter(L){
      const search = document.getElementById('search');
      if(search) search.value = '';
      currentSearch = '';

      currentLetter = L;
      renderFiltered();
    }

    function setupButtons(){
      const letters = [...'ABCDEFGHIJKLMNOPQRSTUVWXYZ'];
      const c = document.getElementById('buttons');
      ['Alles','#',...letters].forEach(L => {
        const b = document.createElement('button');
        b.textContent = L;
        b.addEventListener('click', () => filterByLetter(L));
        c.appendChild(b);
      });
    }

    function filterByLanguage(lang){
      currentLang = lang;
      renderFiltered();
    }

    function setupLanguageButtons(){
      const langs = ['All','Ned','Fra','Dui','Overige'];
      const c = document.getElementById('lang-buttons');
      if (!c) return;
      c.innerHTML = '';
      langs.forEach(L => {
        const b = document.createElement('button');
        b.textContent = L;
        b.addEventListener('click', () => filterByLanguage(L));
        c.appendChild(b);
      });
    }

    function getInitialListFont() {
      const raw = getComputedStyle(document.documentElement)
        .getPropertyValue('--list-font').trim();
      const num = parseFloat(raw);
      return isNaN(num) ? 1.0 : num;
    }

    let fontSizeEm = getInitialListFont();

    function applyFontSize() {
      document.documentElement.style.setProperty('--list-font', fontSizeEm + 'em');
    }

    const STEP=0.05, MIN=0.50, MAX=1.60;
    document.addEventListener('click', e => {
      if(e.target && e.target.id === 'font-dec'){
        fontSizeEm = Math.max(MIN, +(fontSizeEm - STEP).toFixed(2));
        applyFontSize();
      }
      if(e.target && e.target.id === 'font-inc'){
        fontSizeEm = Math.min(MAX, +(fontSizeEm + STEP).toFixed(2));
        applyFontSize();
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('search').addEventListener('input', e => {
        currentSearch = e.target.value;
        renderFiltered();
      });

      setupButtons();
      setupLanguageButtons();
      loadSongs(true);
    });

    document.addEventListener('visibilitychange',()=>{
      if(!document.hidden) loadSongs(true);
    });
  </script>
</body>
</html>


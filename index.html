
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vocaluxe Songs</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root { --list-font: 0.95em; }
    html, body {
      margin:0; padding:0; font-family:Arial,sans-serif; color:white; height:100%;
      background:url('SiteBG.png') no-repeat center top;
      background-size:cover; background-position:center top; background-attachment:fixed; overflow:hidden;
    }
    @media (max-width:820px){
      html, body { background-size:auto 100%; background-position:center top; }
      :root { --list-font: 0.70em; } /* mobiele startgrootte */
    }
    .top-meta{position:fixed;top:0;left:0;width:100%;background:rgba(0,0,0,.6);z-index:2000;box-shadow:0 2px 8px rgba(0,0,0,.35)}
    .top-meta .meta-wrap{max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:12px;padding:6px 16px;font-size:.70em}
    .top-bar{position:sticky;top:165px;width:100%;z-index:1000;text-align:center;padding-bottom:6px;background:rgba(0,0,0,0)}
    .filter-row{display:flex;justify-content:center;align-items:center;gap:5px;margin-top:5px;flex-wrap:wrap;position:relative}
    .filter-buttons{display:flex;flex-wrap:wrap;justify-content:center;gap:5px;margin-bottom:5px}
    .filter-buttons button{padding:5px;border:none;border-radius:2px;background-color:rgba(0,0,0,.6);color:#fff;cursor:pointer;font-size:1em}
    .filter-buttons button:hover{background-color:rgba(255,255,255,.2)}
    #search{padding:5px;font-size:1em;width:min(90%,420px);border-radius:5px;border:none;margin:5px 0 0;background-color:rgba(255,255,255,.2);color:#fff}
    .font-controls-mobile{display:none;position:absolute;left:50px;top:-40px;gap:6px}
    .font-btn{padding:6px 10px;border:none;border-radius:4px;background-color:rgba(0,0,0,.6);color:#fff;cursor:pointer;font-size:1em;line-height:1}
    .content{position:absolute;top:230px;bottom:0;left:0;right:0;overflow-y:auto;padding:10px 0 20px;text-align:center}
    #song-list{background:rgba(0,0,0,.6);margin:0 auto;max-width:900px;border-radius:10px;padding:10px 0}
    .line{display:flex;justify-content:center;align-items:center;font-size:var(--list-font);padding:4px 0}
    .left-col{width:40%;text-align:right;padding-right:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .right-col{width:40%;text-align:left;padding-left:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    @media (max-width:820px){
      .filter-buttons{display:none}
      .top-meta .meta-wrap{padding:6px 10px;font-size:.9em}
      #search{width:92%}
      .font-controls-mobile{display:flex}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <div class="top-meta"><div class="meta-wrap"><div id="last-update">Update: —</div><div id="song-count">— liedjes</div></div></div>
  <div class="top-bar">
    <div class="filter-buttons" id="buttons"></div>
    <div class="filter-row">
      <div class="font-controls-mobile" aria-label="Lettergrootte">
        <button id="font-dec" class="font-btn" title="Kleiner">A−</button>
        <button id="font-inc" class="font-btn" title="Groter">A+</button>
      </div>
      <input type="text" id="search" placeholder="Zoek op uitvoerder of titel..." />
    </div>
  </div>
  <div class="content"><div id="song-list">Laden...</div></div>
  <script>
    let allSongs=[], totalCount=0, lastLoaded=null;

    // CSS-startwaarde van --list-font gebruiken
    function getInitialListFont(){
      const raw=getComputedStyle(document.documentElement).getPropertyValue('--list-font').trim();
      const num=parseFloat(raw); return isNaN(num)?1.15:num;
    }
    let fontSizeEm=getInitialListFont();

    function applyFontSize(){ document.documentElement.style.setProperty('--list-font', fontSizeEm+'em'); }

    function formatDate(d){ try{ return new Intl.DateTimeFormat('nl-BE',{day:'2-digit',month:'2-digit',year:'numeric'}).format(d) }catch{ return d.toLocaleDateString('nl-BE') } }
    function normKeyMap(o){ const m={}; for(const k in o){ if(!k) continue; m[k.trim().toLowerCase()]=o[k]; } return m; }
    function pick(o,cs){ for(const c of cs){ if(o[c]!=null && String(o[c]).trim()!=='') return String(o[c]).trim(); } return ''; }

    function loadSongs(cacheBust=true){
      const url=cacheBust?`songs.csv?ts=${Date.now()}`:'songs.csv';
      Papa.parse(url,{download:true,header:true,skipEmptyLines:'greedy',complete:r=>{
        lastLoaded=new Date();
        allSongs=r.data.map(row=>{const m=normKeyMap(row);
          const uitvoerder=pick(m,['uitvoerder','uitvoeder','artist','artiest','performer','singer']);
          const titel=pick(m,['titel','title','song','nummer','track']); return {uitvoerder,titel};})
          .filter(s=>s.uitvoerder&&s.titel);
        totalCount=allSongs.length; displaySongs(allSongs);
      },error:err=>{document.getElementById('song-list').textContent='Fout bij laden van songs.csv: '+err.message;}});
    }

    function updateMetaInfo(n){
      const total=totalCount.toLocaleString('nl-BE'), shown=n.toLocaleString('nl-BE'), dateStr=lastLoaded?formatDate(lastLoaded):'—';
      document.getElementById('last-update').textContent=`Update: ${dateStr}`;
      document.getElementById('song-count').textContent=(n!==totalCount)?`${total} liedjes — ${shown} getoond`:`${total} liedjes`;
    }

    function displaySongs(s){
      const list=document.getElementById('song-list'); list.innerHTML='';
      const sorted=s.slice().sort((a,b)=>a.uitvoerder.localeCompare(b.uitvoerder));
      sorted.forEach(x=>{ const div=document.createElement('div'); div.className='line';
        div.innerHTML=`<div class="left-col">${x.uitvoerder}</div><div class="right-col">${x.titel}</div>`; list.appendChild(div); });
      updateMetaInfo(sorted.length);
      const sc=document.querySelector('.content'); if(sc) sc.scrollTo({top:0,behavior:'auto'});
    }

    function filterByLetter(L){ const search=document.getElementById('search'); if(search) search.value='';
      if(L==='Alles') return displaySongs(allSongs);
      if(L==='#') return displaySongs(allSongs.filter(s=>!/^[a-zA-Z]/.test(s.uitvoerder)));
      displaySongs(allSongs.filter(s=>s.uitvoerder.toUpperCase().startsWith(L)));
    }

    function setupButtons(){ const letters=[...'ABCDEFGHIJKLMNOPQRSTUVWXYZ'], c=document.getElementById('buttons');
      ['Alles','#',...letters].forEach(L=>{ const b=document.createElement('button'); b.textContent=L; b.onclick=()=>filterByLetter(L); c.appendChild(b); });
    }

    document.getElementById('search').addEventListener('input',e=>{
      const t=e.target.value.toLowerCase(); if(!t) return displaySongs(allSongs);
      displaySongs(allSongs.filter(s=>s.uitvoerder.toLowerCase().includes(t)||s.titel.toLowerCase().includes(t)));
    });

    // ✅ Nieuwe, veilige grenzen en stapgrootte voor A-/A+ (werken ook vanaf 0.70em)
    const STEP=0.05, MIN=0.50, MAX=1.40;
    document.addEventListener('click',e=>{
      if(e.target.id==='font-dec'){ fontSizeEm = Math.max(MIN, +(fontSizeEm-STEP).toFixed(2)); applyFontSize(); }
      if(e.target.id==='font-inc'){ fontSizeEm = Math.min(MAX, +(fontSizeEm+STEP).toFixed(2)); applyFontSize(); }
    });

    setupButtons();
    applyFontSize(); // zet inline startwaarde gelijk aan CSS
    loadSongs(true);
    document.addEventListener('visibilitychange',()=>{ if(!document.hidden) loadSongs(true); });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vocaluxe Songs</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    /* ===============================
       Globale variabelen en resets
       =============================== */
    :root {
      /* Lettergrootte van de lijst */
      --list-font: 0.95em;

      /* ====== Standaard (wordt overschreven per device) ====== */
      --letters-top: 100px;   /* Hoogte van de letterknoppenbalk */
      --search-top: 190px;    /* Hoogte van het zoekveld */
      --font-top: 145px;      /* Hoogte van A-/A+ */
      --content-top: 240px;   /* Startpositie van de scrollbare lijst */
    }

    /* ====== Mobiele standaardwaarden (aanpasbaar) ====== */
    :root {
      --phone-letters-top: 120px;
      --phone-search-top: 170px;
      --phone-font-top: 125px;
      --phone-content-top: 220px;
      --phone-list-font: 0.80em;  /* standaard lijstgrootte mobiel */
    }

    /* ====== Desktop standaardwaarden (aanpasbaar) ====== */
    :root {
      --desk-letters-top: 160px;
      --desk-search-top: 210px;
      --desk-font-top: 165px;
      --desk-content-top: 260px;
      --desk-list-font: 0.95em;   /* standaard lijstgrootte desktop */
    }

    /* Altijd zwarte basis */
    html { background:#000 !important; }
    body {
      margin:0; padding:0; font-family:Arial, sans-serif; color:#fff;
      min-height:100vh;
      /* Achtergrondinstellingen: geen cropping + fixed */
      background-repeat:no-repeat;
      background-position:center top;
      background-size:cover;     /* zorgt voor volledig zichtbare afbeelding */
      background-attachment:fixed; /* blijft staan tijdens scrollen */
      overflow:hidden;             /* we scrollen enkel in .content */
    }

    /* üì± Mobiel: BGPHONE.png + eigen variabelen mappen */
    @media (max-width: 820px) {
      body { background-image:url('BGPHONE.png'); }
      :root {
        --letters-top: var(--phone-letters-top);
        --search-top: var(--phone-search-top);
        --font-top: var(--phone-font-top);
        --content-top: var(--phone-content-top);
        --list-font: var(--phone-list-font);
      }
    }

    /* üñ•Ô∏è Desktop: BGDESK.png + eigen variabelen mappen */
    @media (min-width: 821px) {
      body { background-image:url('BGDESK.png'); }
      :root {
        --letters-top: var(--desk-letters-top);
        --search-top: var(--desk-search-top);
        --font-top: var(--desk-font-top);
        --content-top: var(--desk-content-top);
        --list-font: var(--desk-list-font);
      }
    }

    /* A-/A+ vaste positie */
    .font-controls {
      position:fixed;
      top:var(--font-top);
      right:clamp(12px, 4vw, 32px);
      display:flex; gap:8px;
      z-index:1200;
    }
    .font-btn {
      padding:6px 10px; border:none; border-radius:6px;
      background:rgba(0,0,0,.6); color:#fff; cursor:pointer; font-size:1em; line-height:1;
    }
    .font-btn:hover { background:rgba(255,255,255,.2); }

    /* Letterknoppen ‚Äì vaste positie, gecentreerd */
    #letters-bar {
      position:fixed; top:var(--letters-top); left:0; right:0;
      z-index:1100; text-align:center; padding-bottom:6px;
      background:transparent;
    }
    .filter-buttons {
      display:flex; flex-wrap:wrap; justify-content:center; gap:6px; margin:0 auto;
      max-width:1100px;
    }
    .filter-buttons button {
      padding:6px 10px; border:none; border-radius:6px;
      background:rgba(0,0,0,.6); color:#fff; cursor:pointer; font-size:1em;
    }
    .filter-buttons button:hover { background:rgba(255,255,255,.2); }

    /* Zoekveld ‚Äì vaste positie, gecentreerd */
    #search {
      position:fixed; top:var(--search-top); left:50%; transform:translateX(-50%);
      padding:8px; font-size:1em; width:min(90%, 520px);
      border-radius:8px; border:none; margin:0;
      background:rgba(255,255,255,.2); color:#fff;
      z-index:1150;
    }

    /* Scrollbare content (lijst) ‚Äì hoogte instelbaar via var(--content-top) */
    .content {
      position:absolute; top:var(--content-top); bottom:0; left:0; right:0;
      overflow-y:auto; padding:10px 0 24px; text-align:center;
    }
    #song-list {
      background:rgba(0,0,0,.6); margin:0 auto; max-width:900px; border-radius:10px; padding:10px 0;
    }
    .line {
      display:flex; justify-content:center; align-items:center;
      font-size:var(--list-font); padding:4px 0;
    }
    .left-col, .right-col {
      width:40%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
    .left-col { text-align:right; padding-right:10px; }
    .right-col { text-align:left; padding-left:10px; }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <!-- Bovenste infobalk -->
  <div class="top-meta">
    <div class="meta-wrap">
      <div id="last-update">Update: ‚Äî</div>
      <div id="song-count">‚Äî liedjes</div>
    </div>
  </div>

  <!-- A-/A+ (nu voor desktop √©n mobiel) -->
  <div class="font-controls" aria-label="Lettergrootte">
    <button id="font-dec" class="font-btn" title="Kleiner">A‚àí</button>
    <button id="font-inc" class="font-btn" title="Groter">A+</button>
  </div>

  <!-- Letterknoppen (losgekoppeld, eigen hoogte) -->
  <div id="letters-bar">
    <div class="filter-buttons" id="buttons"></div>
  </div>

  <!-- Zoekveld (losgekoppeld, eigen hoogte) -->
  <input type="text" id="search" placeholder="Zoek op uitvoerder of titel..." />

  <!-- Scrollbare lijst -->
  <div class="content">
    <div id="song-list">Laden...</div>
  </div>

  <script>
    // ===============================
    // Logica & helperfuncties
    // ===============================
    let allSongs = [], totalCount = 0, lastLoaded = null;

    function getInitialListFont() {
      const raw = getComputedStyle(document.documentElement).getPropertyValue('--list-font').trim();
      const num = parseFloat(raw);
      return isNaN(num) ? 1.0 : num;
    }
    let fontSizeEm = getInitialListFont();
    function applyFontSize() {
      document.documentElement.style.setProperty('--list-font', fontSizeEm + 'em');
    }

    function formatDate(d) {
      try {
        return new Intl.DateTimeFormat('nl-BE', { day:'2-digit', month:'2-digit', year:'numeric' }).format(d);
      } catch {
        return d.toLocaleDateString('nl-BE');
      }
    }

    function normKeyMap(o){
      const m={};
      for(const k in o){ if(!k) continue; m[k.trim().toLowerCase()] = o[k]; }
      return m;
    }

    function pick(o, candidates){
      for(const c of candidates){
        if(o[c]!=null && String(o[c]).trim()!=='') return String(o[c]).trim();
      }
      return '';
    }

    function loadSongs(cacheBust=true){
      const url = cacheBust ? `songs.csv?ts=${Date.now()}` : 'songs.csv';
      Papa.parse(url, {
        download: true, header: true, skipEmptyLines: 'greedy',
        complete: result => {
          lastLoaded = new Date();
          allSongs = result.data.map(row => {
            const m = normKeyMap(row);
            const uitvoerder = pick(m, ['uitvoerder','uitvoeder','artist','artiest','performer','singer']);
            const titel = pick(m, ['titel','title','song','nummer','track']);
            return { uitvoerder, titel };
          }).filter(s => s.uitvoerder && s.titel);

          totalCount = allSongs.length;
          displaySongs(allSongs);
        },
        error: err => {
          document.getElementById('song-list').textContent = 'Fout bij laden van songs.csv: ' + err.message;
        }
      });
    }

    function updateMetaInfo(shownCount){
      const total = totalCount.toLocaleString('nl-BE');
      const shown = shownCount.toLocaleString('nl-BE');
      const dateStr = lastLoaded ? formatDate(lastLoaded) : '‚Äî';
      document.getElementById('last-update').textContent = `Update: ${dateStr}`;
      document.getElementById('song-count').textContent =
        (shownCount !== totalCount) ? `${total} liedjes ‚Äî ${shown} getoond` : `${total} liedjes`;
    }

    function displaySongs(list){
      const container = document.getElementById('song-list');
      container.innerHTML = '';
      const sorted = list.slice().sort((a,b)=>a.uitvoerder.localeCompare(b.uitvoerder));
      sorted.forEach(x => {
        const div = document.createElement('div');
        div.className = 'line';
        div.innerHTML = `<div class="left-col">${x.uitvoerder}</div><div class="right-col">${x.titel}</div>`;
        container.appendChild(div);
      });
      updateMetaInfo(sorted.length);
      const scroller = document.querySelector('.content');
      if(scroller) scroller.scrollTo({ top: 0, behavior: 'auto' });
    }

    function filterByLetter(L){
      const search = document.getElementById('search');
      if(search) search.value = '';
      if(L==='Alles') return displaySongs(allSongs);
      if(L==='#') return displaySongs(allSongs.filter(s=>!/^[a-zA-Z]/.test(s.uitvoerder)));
      displaySongs(allSongs.filter(s=>s.uitvoerder.toUpperCase().startsWith(L)));
    }

    function setupButtons(){
      const letters = [...'ABCDEFGHIJKLMNOPQRSTUVWXYZ'];
      const c = document.getElementById('buttons');
      ['Alles','#',...letters].forEach(L => {
        const b = document.createElement('button');
        b.textContent = L;
        b.onclick = () => filterByLetter(L);
        c.appendChild(b);
      });
    }

    // Live zoeken
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('search').addEventListener('input', e => {
        const t = e.target.value.toLowerCase();
        if(!t) return displaySongs(allSongs);
        displaySongs(allSongs.filter(s =>
          s.uitvoerder.toLowerCase().includes(t) || s.titel.toLowerCase().includes(t)
        ));
      });
    });

    // A-/A+ bediening
    const STEP=0.05, MIN=0.50, MAX=1.60;
    document.addEventListener('click', e => {
      if(e.target && e.target.id === 'font-dec'){
        fontSizeEm = Math.max(MIN, +(fontSizeEm - STEP).toFixed(2));
        applyFontSize();
      }
      if(e.target && e.target.id === 'font-inc'){
        fontSizeEm = Math.min(MAX, +(fontSizeEm + STEP).toFixed(2));
        applyFontSize();
      }
    });

    // Init
    setupButtons();
    applyFontSize();
    loadSongs(true);

    // Herladen bij terugkeren naar tab
    document.addEventListener('visibilitychange',()=>{
      if(!document.hidden) loadSongs(true);
    });
  </script>
</body>
</html>
